<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Reina üíó</title>
  <style>
    :root{
      --bg1:#0b1020; --bg2:#1a0f2e;
      --glass: rgba(255,255,255,0.10);
      --line: rgba(255,255,255,0.16);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --accent:#ff4d8d;
      --radius: 22px;
      --shadow: 0 26px 80px rgba(0,0,0,0.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(900px 650px at 20% 10%, rgba(255,77,141,0.22), transparent 60%),
        radial-gradient(900px 700px at 80% 25%, rgba(255,209,223,0.14), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* Background */
    .bg{position:fixed; inset:0; z-index:-2; pointer-events:none; opacity:0.95; overflow:hidden;}
    .bg::before{content:""; position:absolute; inset:-20px; background: linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.62)); z-index:3;}
    .tiles{position:absolute; inset:0; padding:16px; display:grid; grid-template-columns:repeat(12,1fr); grid-template-rows:repeat(10,1fr); gap:10px; z-index:1;}
    .tile{border-radius:18px; border:1px solid rgba(255,255,255,0.10); background: rgba(255,255,255,0.04); overflow:hidden;}
    .tile svg{width:100%; height:100%; display:block; opacity:0.92;}
    .sparkles{position:absolute; inset:0; z-index:2; opacity:0.65;}
    .sparkle{position:absolute; animation: twinkle 2.6s ease-in-out infinite;}
    @keyframes twinkle{0%,100%{transform:scale(0.9); opacity:0.25}50%{transform:scale(1.25); opacity:0.9}}

    /* Layout */
    .wrap{max-width:1050px; margin:0 auto; padding:20px 14px 70px; min-height:100vh; display:flex; flex-direction:column; gap:14px;}
    header{display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;}
    .brand{display:flex; align-items:center; gap:10px; font-weight:900;}
    .badge{display:inline-flex; align-items:center; gap:8px; padding:7px 11px; border-radius:999px; background: rgba(255,255,255,0.10); border:1px solid rgba(255,255,255,0.14); color: rgba(255,255,255,0.78); font-size:12px;}

    .stage{border-radius: calc(var(--radius) + 10px); border:1px solid rgba(255,255,255,0.14);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      box-shadow: var(--shadow); overflow:hidden;}
    .inner{padding:18px;}
    .screen{display:none; animation: fadeIn 220ms ease forwards;}
    .screen.active{display:block;}
    @keyframes fadeIn{from{opacity:0; transform: translateY(6px)}to{opacity:1; transform: translateY(0)}}

    .card{border-radius: var(--radius); background: var(--glass); border:1px solid rgba(255,255,255,0.14); padding:16px;}
    h1{margin:0 0 10px; font-size:clamp(22px, 3.6vw, 36px); line-height:1.15}
    .lead{margin:0; color:var(--muted); font-size:15px; line-height:1.55}
    .tiny{font-size:12px; color: rgba(255,255,255,0.65)}
    .divider{height:1px; background:rgba(255,255,255,0.12); margin:12px 0}
    .cta{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    button{border:none; border-radius:16px; padding:12px 14px; font-weight:900; cursor:pointer;}
    button:active{transform:scale(0.985)}
    .btn-primary{background: linear-gradient(135deg, var(--accent), #ff2f76); color:white;}
    .btn-ghost{background: rgba(255,255,255,0.10); border:1px solid rgba(255,255,255,0.16); color: rgba(255,255,255,0.90);}

    /* Letter + envelope */
    .letter-grid{display:grid; grid-template-columns: 0.95fr 1.05fr; gap:14px; align-items:start;}
    @media (max-width:900px){.letter-grid{grid-template-columns:1fr}}
    .envelope-stage{position:relative; height:360px; border-radius: var(--radius); background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.14); overflow:hidden;}
    .env{position:absolute; left:50%; top:55%; transform: translate(-50%, -50%); width:min(440px, 92%); height:250px; cursor:pointer; user-select:none;}
    .env-body{position:absolute; inset:0; border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.94), rgba(255,255,255,0.84));
      border:1px solid rgba(255,255,255,0.70); overflow:hidden;}
    .env-flap{position:absolute; left:0; right:0; top:0; height:58%;
      transform-origin: top center; transition: transform 650ms cubic-bezier(.2,.9,.2,1);
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      border-top-left-radius:18px; border-top-right-radius:18px;
      background: linear-gradient(180deg, rgba(255,77,141,0.18), rgba(255,255,255,0.0));
      border:1px solid rgba(255,255,255,0.70); border-bottom:none;}
    .paper{position:absolute; left:50%; top:14px; transform: translateX(-50%);
      width:86%; height:220px; border-radius:16px;
      background: rgba(255,255,255,0.94); border:1px solid rgba(255,255,255,0.78);
      box-shadow: 0 18px 38px rgba(0,0,0,0.28);
      transition: transform 850ms cubic-bezier(.2,.9,.2,1), opacity 300ms ease;
      opacity:0; pointer-events:none; overflow:hidden;}
    .paper-inner{position:absolute; inset:14px; overflow:auto; color: rgba(20,20,26,0.92); font-size:15px; line-height:1.55;}
    .paper-nav{position:absolute; left:12px; right:12px; bottom:10px; display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding-top:8px; border-top: 1px solid rgba(0,0,0,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0), rgba(255,255,255,0.92) 35%);}
    .paper-nav .mini{border:none; border-radius: 12px; padding:8px 10px; font-weight:900; cursor:pointer; background: rgba(255,77,141,0.12); color: rgba(20,20,26,0.88);}
    .paper-nav .count{font-size:12px; color: rgba(20,20,26,0.65); font-weight:800}
    .env.open .env-flap{transform: rotateX(165deg)}
    .env.open .paper{opacity:1; transform: translateX(-50%) translateY(150px)}
    .seal{position:absolute; left:0; right:0; bottom:0; height:58px;
      background: rgba(255,77,141,0.10); border-top:1px solid rgba(255,77,141,0.25);
      display:flex; align-items:center; justify-content:center; gap:10px;}
    .seal span{color: rgba(20,20,26,0.72); font-weight:900;}

    /* Question */
    .center{display:flex; flex-direction:column; gap:14px; align-items:center; text-align:center; padding: 14px;}
    .choice-row{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    .btn-yes{background: linear-gradient(135deg, #35d07f, #1fc56f); color:white;}
    .btn-no{background: rgba(255,107,107,0.16); border:1px solid rgba(255,107,107,0.32); color: rgba(255,255,255,0.92); position:relative;}

    /* Options */
    .opt-grid{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media (max-width:820px){.opt-grid{grid-template-columns:1fr}}
    .opt{border-radius: var(--radius); border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.08); padding:14px; text-align:left; cursor:pointer;}
    .opt b{display:block; margin-bottom:6px}
    .opt span{color: rgba(255,255,255,0.75); line-height:1.5}

    .footer{text-align:center; color: rgba(255,255,255,0.55); font-size:12px; margin-top:6px;}

    @media (prefers-reduced-motion: reduce){
      .sparkle{animation:none}
      .env-flap,.paper{transition:none}
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true">
    <div class="tiles" id="tiles"></div>
    <div class="sparkles" id="sparkles"></div>
  </div>

  <div class="wrap">
    <header>
      <div class="brand">
        <span style="font-size:18px">üíå</span>
        <span>Mi Reina üíó</span>
        <span class="badge">from: You</span>
      </div>
      <div class="badge" id="todayBadge">Loading‚Ä¶</div>
    </header>

    <main class="stage">
      <div class="inner">

        <!-- INTRO -->
        <section class="screen active" id="screenIntro">
          <div class="card">
            <h1 id="introText">IF you are here right now, you're the love of my life and i want to spend rest of my life with you till we become old and rusted. SO let's get started.</h1>
            <p class="lead">Tap the button. The next part is for you.</p>
            <div class="cta">
              <button class="btn-primary" id="btnStart">Let‚Äôs get started üíñ</button>
            </div>
            <div class="divider"></div>
            <p class="tiny">If this feels too animated, enable ‚ÄúReduce motion‚Äù on your phone/PC.</p>
          </div>
        </section>

        <!-- LETTER -->
        <section class="screen" id="screenLetter">
          <div class="letter-grid">
            <div>
              <div class="card">
                <h1 style="font-size:22px;margin-bottom:6px">Your letter üíå</h1>
                <p class="tiny" style="margin:0">Tap the envelope to open. Use Prev/Next to turn pages.</p>
              </div>

              <div style="height:12px"></div>

              <div class="envelope-stage">
                <div class="env" id="envelope" role="button" tabindex="0" aria-label="Open the envelope">
                  <div class="env-body">
                    <div class="env-flap"></div>

                    <div class="paper" id="paper">
                      <div class="paper-inner" id="paperInner"></div>
                      <div class="paper-nav">
                        <button class="mini" id="btnPrev">‚Üê Prev</button>
                        <div class="count" id="pageCount">Page 1 / 1</div>
                        <button class="mini" id="btnNext">Next ‚Üí</button>
                      </div>
                    </div>

                    <div class="seal">
                      <span>Open me</span><span>üíó</span><span>‚úâÔ∏è</span>
                    </div>
                  </div>
                </div>
              </div>

              <div style="height:12px"></div>

              <div class="card">
                <div class="cta" style="justify-content:space-between; margin-top:0;">
                  <button class="btn-ghost" id="btnBack">‚Üê Back</button>
                  <button class="btn-primary" id="btnAfterLetter">Next üíó</button>
                </div>
              </div>
            </div>

            <div class="card">
              <p class="lead">
                This is placeholder letter text. When you send your real letter, I‚Äôll split it into pages and paste it here.
              </p>
            </div>
          </div>
        </section>

        <!-- QUESTION -->
        <section class="screen" id="screenQuestion">
          <div class="card center">
            <h1 style="margin-bottom:0">Now a really important question for you Mi Reina üíó</h1>
            <p class="lead">Will you be my Valentine‚Äôs?</p>
            <div class="choice-row">
              <button class="btn-yes" id="btnYes">Yes üíñ</button>
              <button class="btn-no" id="btnNo">No üôÉ</button>
            </div>
          </div>
        </section>

        <!-- SETUP -->
        <section class="screen" id="screenSetup">
          <div class="card center">
            <h1 style="margin-bottom:0">Let‚Äôs get it all set for a date üíó</h1>
            <p class="lead">One more step.</p>
            <div class="cta" style="justify-content:center">
              <button class="btn-primary" id="btnToChoices">Next ‚Üí</button>
            </div>
          </div>
        </section>

        <!-- CHOICES -->
        <section class="screen" id="screenChoices">
          <div class="card">
            <h1 style="margin-bottom:8px">Choose a date</h1>
            <p class="lead">Pick one option below.</p>
            <div class="divider"></div>
            <div class="opt-grid">
              <div class="opt" id="opt1" role="button" tabindex="0">
                <b>Cooking together</b>
                <span>I'll cook whatever you want me to cook + movie night + virtual gifts from me + wine</span>
              </div>
              <div class="opt" id="opt2" role="button" tabindex="0">
                <b>Going out</b>
                <span>Going out somewhere to eat in a restaurant + movie night + wine + virtual gifts from me</span>
              </div>
            </div>
          </div>
        </section>

        <!-- THANKS -->
        <section class="screen" id="screenThanks">
          <div class="card center">
            <h1 style="margin-bottom:0">Thank you for being my Valentine üíñ</h1>
            <p class="lead" id="chosenText"></p>
          </div>
        </section>

        <div class="footer">Made with üíó and intent.</div>
      </div>
    </main>
  </div>

  <script>
    // Show errors in the badge so we never guess again.
    window.addEventListener("error", (e) => {
      const b = document.getElementById("todayBadge");
      if (b) b.textContent = "JS error: " + (e?.message || "unknown");
    });
    window.addEventListener("unhandledrejection", () => {
      const b = document.getElementById("todayBadge");
      if (b) b.textContent = "JS error: promise";
    });

    (function(){
      const $ = (id) => document.getElementById(id);

      // Badge proves JS is alive.
      const badge = $("todayBadge");
      if (badge) {
        badge.textContent = "Today: " + new Date().toLocaleDateString(undefined, {weekday:"short", year:"numeric", month:"short", day:"numeric"});
      }

      // Screens
      const screens = ["screenIntro","screenLetter","screenQuestion","screenSetup","screenChoices","screenThanks"];
      function show(id){
        screens.forEach(s => { const el = $(s); if(el) el.classList.remove("active"); });
        const on = $(id);
        if (on) on.classList.add("active");
        window.scrollTo({top:0, behavior:"smooth"});
      }

      // Background: original chibi/anime-style SVG tiles (no external links).
      function coupleSvg(seed){
        const hair1 = seed % 2 === 0 ? "#2a2a2e" : "#3a2b2b";
        const hair2 = seed % 3 === 0 ? "#2b3a4a" : "#2b2b3a";
        const blush = "rgba(255,77,141,0.55)";
        return `
          <svg viewBox="0 0 400 500" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="g${seed}" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="rgba(255,77,141,0.25)"/>
                <stop offset="1" stop-color="rgba(255,209,223,0.12)"/>
              </linearGradient>
            </defs>
            <rect width="400" height="500" fill="url(#g${seed})"/>
            <g transform="translate(38,38)">
              <path d="M292 54c-10-18-33-18-43-2-10-16-33-16-43 2-11 20 8 38 43 64 35-26 54-44 43-64z"
                    fill="rgba(255,77,141,0.55)"/>
              <g transform="translate(66,170)">
                <circle cx="70" cy="70" r="70" fill="rgba(255,255,255,0.82)"/>
                <path d="M5 70c20-55 65-80 130-55 5 40-10 70-25 90-25-20-60-20-80 0-16-18-26-40-25-35z"
                      fill="${hair1}" opacity="0.9"/>
                <circle cx="45" cy="78" r="8" fill="#111"/><circle cx="95" cy="78" r="8" fill="#111"/>
                <circle cx="45" cy="78" r="3" fill="#fff"/><circle cx="95" cy="78" r="3" fill="#fff"/>
                <path d="M65 100c10 10 20 10 30 0" stroke="#111" stroke-width="6" stroke-linecap="round" fill="none"/>
                <circle cx="30" cy="102" r="10" fill="${blush}"/><circle cx="110" cy="102" r="10" fill="${blush}"/>
              </g>
              <g transform="translate(190,170)">
                <circle cx="70" cy="70" r="70" fill="rgba(255,255,255,0.82)"/>
                <path d="M10 60c18-50 68-70 130-40-5 50-30 75-45 92-18-18-55-22-80 0-12-12-22-25-25-52z"
                      fill="${hair2}" opacity="0.9"/>
                <circle cx="45" cy="78" r="8" fill="#111"/><circle cx="95" cy="78" r="8" fill="#111"/>
                <circle cx="45" cy="78" r="3" fill="#fff"/><circle cx="95" cy="78" r="3" fill="#fff"/>
                <path d="M62 102c12 8 24 8 36 0" stroke="#111" stroke-width="6" stroke-linecap="round" fill="none"/>
                <circle cx="30" cy="102" r="10" fill="${blush}"/><circle cx="110" cy="102" r="10" fill="${blush}"/>
              </g>
            </g>
          </svg>
        `;
      }

      const tiles = $("tiles");
      if (tiles) {
        tiles.innerHTML = "";
        for(let i=1;i<=10;i++){
          const t = document.createElement("div");
          t.className = "tile";
          const colStart = (i % 10) + 1;
          const rowStart = (i % 7) + 1;
          const colSpan = (i % 3) + 3;
          const rowSpan = (i % 2) + 3;
          t.style.gridColumn = `${colStart} / span ${colSpan}`;
          t.style.gridRow = `${rowStart} / span ${rowSpan}`;
          t.innerHTML = coupleSvg(i);
          tiles.appendChild(t);
        }
      }

      const sparkles = $("sparkles");
      if (sparkles) {
        sparkles.innerHTML = "";
        const sparkleChars = ["‚ú®","‚ú¶","‚úß","‚ãÜ","üí´"];
        for(let i=0;i<16;i++){
          const s = document.createElement("div");
          s.className = "sparkle";
          s.textContent = sparkleChars[Math.floor(Math.random()*sparkleChars.length)];
          s.style.left = (Math.random()*100).toFixed(2) + "%";
          s.style.top  = (Math.random()*100).toFixed(2) + "%";
          s.style.animationDelay = (Math.random()*2.4).toFixed(2) + "s";
          s.style.fontSize = (12 + Math.random()*10).toFixed(0) + "px";
          sparkles.appendChild(s);
        }
      }

      // Letter pages (placeholder - you‚Äôll replace later)
      const pages = [
        "<b>Page 1</b><br><br>Paste your real letter later. I‚Äôll split it into pages for you.",
        "<b>Page 2</b><br><br>Placeholder page 2.",
        "<b>Page 3</b><br><br>Placeholder page 3."
      ];
      let pageIndex = 0;

      function renderPage(){
        const inner = $("paperInner");
        const count = $("pageCount");
        const prev = $("btnPrev");
        const next = $("btnNext");
        if (inner) inner.innerHTML = pages[pageIndex] || "";
        if (count) count.textContent = `Page ${pageIndex+1} / ${pages.length}`;
        if (prev) prev.disabled = pageIndex === 0;
        if (next) next.disabled = pageIndex === pages.length - 1;
      }
      renderPage();

      const prevBtn = $("btnPrev");
      const nextBtn = $("btnNext");
      if (prevBtn) prevBtn.addEventListener("click", (e)=>{ e.stopPropagation(); if(pageIndex>0){ pageIndex--; renderPage(); }});
      if (nextBtn) nextBtn.addEventListener("click", (e)=>{ e.stopPropagation(); if(pageIndex<pages.length-1){ pageIndex++; renderPage(); }});

      // Envelope open
      const env = $("envelope");
      let opened = false;
      function toggleEnvelope(){
        opened = !opened;
        if (env) env.classList.toggle("open", opened);
      }
      if (env) {
        env.addEventListener("click", toggleEnvelope);
        env.addEventListener("keydown", (e)=>{ if(e.key==="Enter" || e.key===" ") toggleEnvelope(); });
      }

      // Navigation
      const btnStart = $("btnStart");
      const btnBack = $("btnBack");
      const btnAfter = $("btnAfterLetter");
      const btnYes = $("btnYes");
      const btnNo = $("btnNo");
      const btnToChoices = $("btnToChoices");

      if (btnStart) btnStart.addEventListener("click", ()=> show("screenLetter"));
      if (btnBack) btnBack.addEventListener("click", ()=> show("screenIntro"));
      if (btnAfter) btnAfter.addEventListener("click", ()=> show("screenQuestion"));
      if (btnYes) btnYes.addEventListener("click", ()=> show("screenSetup"));
      if (btnToChoices) btnToChoices.addEventListener("click", ()=> show("screenChoices"));

      // No button dodge
      function dodgeNo(){
        if (!btnNo) return;
        const pad = 12, w=140, h=52;
        const maxX = Math.max(pad, window.innerWidth - w - pad);
        const maxY = Math.max(pad, window.innerHeight - h - pad);
        const x = pad + Math.random()*(maxX - pa
